import{j as e,r as n}from"./index-iG59JKom.js";import{u as L,T as d,c as W,d as U,a as l,e as k}from"./index.esm-23GHL4SO.js";import{a as m}from"./api-D2tvMSLR.js";import{q as N,C as z,B as h,r as v,t as u,P as M}from"./Modal-Dum-JuP6.js";import{A as O}from"./Alert-BsS2lvdT.js";import{T as V,a as $,b as R,c as E,d as s,e as _}from"./TableRow-8qydiO_t.js";import{D as G,a as H,b as J,c as X}from"./DialogTitle-BYpLci-m.js";import{I as Y}from"./IconButton-CEjlZyG7.js";import{F as Z,I as K,S as Q,O as ee}from"./Select-H03bxxAv.js";import{M as ae}from"./MenuItem-BQnuEuMZ.js";import"./Menu-Bb-jsYuj.js";const re=N([e.jsx("circle",{cx:"12",cy:"12",r:"3.2"},"0"),e.jsx("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5"},"1")]),te=3*1024*1024,se=["image/jpeg","image/png","image/gif"],ie=W({name:l().required("Name is required"),description:l().required("Description is required"),category:l().required("Category is required"),date:l().required("Date is required"),location:l().required("Location is required"),price:k().required("Price is required").min(0,"Price must be positive"),image:l().required("Image URL is required"),tagIds:U().of(l()).min(1,"At least one tag is required")}),je=()=>{const[T,w]=n.useState([]),[y,S]=n.useState([]),[D,p]=n.useState(!1),[g,b]=n.useState(null),[C,i]=n.useState(null),[x,I]=n.useState(!1);n.useEffect(()=>{j(),F()},[]);const j=async()=>{try{const r=await m.events.getAll();w(r)}catch(r){i(r instanceof Error?r.message:"Failed to fetch events")}},F=async()=>{try{const r=await m.tags.getAll();S(r)}catch(r){i(r instanceof Error?r.message:"Failed to fetch tags")}},f=()=>{p(!1),b(null),i(null),a.resetForm()},q=r=>new Date(r).toISOString(),P=async r=>{var o;const t=(o=r.target.files)==null?void 0:o[0];if(t){if(t.size>te){i("File size exceeds 3MB limit");return}if(!se.includes(t.type)){i("Invalid file type. Please upload a JPG, PNG, or GIF image.");return}try{I(!0);const c=await m.upload.image(t);a.setFieldValue("image",c),i(null)}catch(c){i(c instanceof Error?c.message:"Failed to upload image")}finally{I(!1)}}},a=L({initialValues:{name:"",description:"",category:"",date:"",location:"",price:"",image:"",tagIds:[]},validationSchema:ie,onSubmit:async r=>{try{const t={...r,price:Number(r.price),date:q(r.date),tagIds:r.tagIds};g?await m.events.update(g.id,t):await m.events.create(t),f(),j()}catch(t){i(t instanceof Error?t.message:"Failed to save event")}}}),B=r=>{var t;b(r),a.setValues({name:r.name,description:r.description,category:r.category,date:new Date(r.date).toISOString().slice(0,16),location:r.location,price:r.price.toString(),image:r.image,tagIds:((t=r.tags)==null?void 0:t.map(o=>o.id))||[]}),p(!0)},A=async r=>{if(window.confirm("Are you sure you want to delete this event?"))try{await m.events.delete(r),j()}catch(t){i(t instanceof Error?t.message:"Failed to delete event")}};return e.jsx(z,{children:e.jsxs(h,{sx:{mt:4,mb:4},children:[C&&e.jsx(O,{severity:"error",sx:{mb:2},onClose:()=>i(null),children:C}),e.jsxs(h,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[e.jsx(v,{variant:"h4",component:"h1",children:"Event Management"}),e.jsx(u,{variant:"contained",onClick:()=>p(!0),children:"Add New Event"})]}),e.jsx(V,{component:M,children:e.jsxs($,{children:[e.jsx(R,{children:e.jsxs(E,{children:[e.jsx(s,{children:"Name"}),e.jsx(s,{children:"Category"}),e.jsx(s,{children:"Date"}),e.jsx(s,{children:"Location"}),e.jsx(s,{children:"Price"}),e.jsx(s,{children:"Tags"}),e.jsx(s,{children:"Image"}),e.jsx(s,{children:"Actions"})]})}),e.jsx(_,{children:T.map(r=>{var t;return e.jsxs(E,{children:[e.jsx(s,{children:r.name}),e.jsx(s,{children:r.category}),e.jsx(s,{children:new Date(r.date).toLocaleString()}),e.jsx(s,{children:r.location}),e.jsxs(s,{children:["$",r.price]}),e.jsx(s,{children:(t=r.tags)==null?void 0:t.map(o=>o.name).join(", ")}),e.jsx(s,{children:e.jsx("img",{src:r.image,alt:r.name,style:{width:"50px",height:"50px",objectFit:"cover"}})}),e.jsxs(s,{children:[e.jsx(u,{size:"small",onClick:()=>B(r),sx:{mr:1},children:"Edit"}),e.jsx(u,{size:"small",color:"error",onClick:()=>A(r.id),children:"Delete"})]})]},r.id)})})]})}),e.jsxs(G,{open:D,onClose:f,maxWidth:"sm",fullWidth:!0,children:[e.jsx(H,{children:g?"Edit Event":"Add New Event"}),e.jsxs("form",{onSubmit:a.handleSubmit,children:[e.jsxs(J,{children:[e.jsx(d,{fullWidth:!0,margin:"normal",name:"name",label:"Event Name",value:a.values.name,onChange:a.handleChange,error:a.touched.name&&!!a.errors.name,helperText:a.touched.name&&a.errors.name}),e.jsx(d,{fullWidth:!0,margin:"normal",name:"description",label:"Description",multiline:!0,rows:4,value:a.values.description,onChange:a.handleChange,error:a.touched.description&&!!a.errors.description,helperText:a.touched.description&&a.errors.description}),e.jsx(d,{fullWidth:!0,margin:"normal",name:"category",label:"Category",value:a.values.category,onChange:a.handleChange,error:a.touched.category&&!!a.errors.category,helperText:a.touched.category&&a.errors.category}),e.jsx(d,{fullWidth:!0,margin:"normal",name:"date",label:"Date",type:"datetime-local",value:a.values.date,onChange:a.handleChange,error:a.touched.date&&!!a.errors.date,helperText:a.touched.date&&a.errors.date,InputLabelProps:{shrink:!0}}),e.jsx(d,{fullWidth:!0,margin:"normal",name:"location",label:"Location",value:a.values.location,onChange:a.handleChange,error:a.touched.location&&!!a.errors.location,helperText:a.touched.location&&a.errors.location}),e.jsx(d,{fullWidth:!0,margin:"normal",name:"price",label:"Price",type:"number",value:a.values.price,onChange:a.handleChange,error:a.touched.price&&!!a.errors.price,helperText:a.touched.price&&a.errors.price}),e.jsxs(h,{sx:{mt:2,mb:2},children:[e.jsx("input",{accept:"image/*",style:{display:"none"},id:"image-upload",type:"file",onChange:P}),e.jsxs("label",{htmlFor:"image-upload",children:[e.jsx(Y,{color:"primary",component:"span",disabled:x,children:e.jsx(re,{})}),x?"Uploading...":"Upload Image"]}),a.values.image&&e.jsx(h,{sx:{mt:1},children:e.jsx("img",{src:a.values.image,alt:"Preview",style:{width:"100px",height:"100px",objectFit:"cover"}})})]}),e.jsxs(Z,{fullWidth:!0,margin:"normal",error:a.touched.tagIds&&!!a.errors.tagIds,children:[e.jsx(K,{id:"tags-label",children:"Tags *"}),e.jsx(Q,{labelId:"tags-label",multiple:!0,name:"tagIds",value:a.values.tagIds,onChange:a.handleChange,input:e.jsx(ee,{label:"Tags *"}),renderValue:r=>e.jsx(h,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:r.map(t=>{const o=y.find(c=>c.id===t);return e.jsx(h,{sx:{bgcolor:"primary.main",color:"white",px:1,py:.5,borderRadius:1,fontSize:"0.8rem"},children:o==null?void 0:o.name},t)})}),children:y.map(r=>e.jsx(ae,{value:r.id,children:r.name},r.id))}),a.touched.tagIds&&a.errors.tagIds&&e.jsx(v,{color:"error",variant:"caption",sx:{mt:.5},children:a.errors.tagIds})]})]}),e.jsxs(X,{children:[e.jsx(u,{onClick:f,children:"Cancel"}),e.jsx(u,{type:"submit",variant:"contained",disabled:x,children:g?"Update":"Create"})]})]})]})]})})};export{je as default};
